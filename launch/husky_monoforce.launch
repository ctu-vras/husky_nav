<?xml version="1.0" encoding="UTF-8" ?>
<launch>
    <arg name="rviz" default="true" doc="Launch RViz for data visualization or not"/>
    <arg name="gui" default="false" doc="Launch Gazebo GUI or not"/>
    <arg name="diffphys" default="false" doc="Launch Diff Physics node or not"/>
<!--     <arg name="world" default="$(dirname)/../worlds/farmWith1CropRow.world"/> -->
<!--    <arg name="world" default="$(dirname)/../worlds/simcity.world"/> -->
<!--     <arg name="world" default="$(dirname)/../worlds/simcity_dynamic.world"/> -->
    <arg name="world" default="$(dirname)/../worlds/emptyfarm.world"/>
<!--     <arg name="world" default="$(dirname)/../worlds/rubicon.world"/> -->

    <!-- Gazebo world and spawn Husky robot -->
    <include file="$(dirname)/husky_sim.launch">
        <arg name="world" value="$(arg world)"/>
    </include>

    <!-- Terrain Encoder -->
    <include file="$(find monoforce)/launch/terrain_encoder.launch">
        <arg name="img_topics" value="['/realsense_front/color/image_raw/compressed',
                                       '/realsense_left/color/image_raw/compressed',
                                       '/realsense_rear/color/image_raw/compressed',
                                       '/realsense_right/color/image_raw/compressed']"/>
        <arg name="camera_info_topics" value="['/realsense_front/color/camera_info',
                                               '/realsense_left/color/camera_info',
                                               '/realsense_rear/color/camera_info',
                                               '/realsense_right/color/camera_info']"/>
        <arg name="hm_frame" value="base_link"/>
        <arg name="max_msgs_delay" value="0.5"/>
        <arg name="max_stale_msg_delay" value="2.0"/>
        <arg name="weights" value="$(find monoforce)/config/weights/lss/lss_robingas_husky.pt"/>
        <arg name="dphys_config_path" value="$(find monoforce)/config/dphys_cfg.yaml"/>
        <arg name="lss_config_path" value="$(find monoforce)/config/lss_cfg_husky.yaml"/>
    </include>

    <!-- Diff Physics node -->
    <node if="$(arg diffphys)" name="diff_physics" pkg="monoforce" type="diff_physics" output="screen">
        <rosparam subst_value="true">
            robot: husky
            hm_topic: /height_map
            hm_frame: base_link
            linear_vels: [0.5, 0.5, 0.5]
            angular_vels: [0., 0.3, -0.3]
            total_sim_time: 4.
            max_stale_msg_delay: 0.5
        </rosparam>
    </node>

    <!-- RViz -->
    <node if="$(arg rviz)" name="rviz" pkg="rviz" type="rviz" args="-d $(dirname)/../config/rviz/lss.rviz"/>
</launch>
