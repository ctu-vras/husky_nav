<?xml version="1.0" encoding="UTF-8" ?>
<launch>
    <arg name="rviz" default="true" doc="Launch RViz for data visualization or not"/>
    <arg name="record" default="false" doc="Record input data or not"/>
    <arg name="world" default="$(dirname)/../../worlds/farmWith1CropRow.world"/>
<!--    <arg name="world" default="$(dirname)/../../worlds/simcity.world"/> -->
<!--     <arg name="world" default="$(dirname)/../../worlds/simcity_dynamic.world"/> -->
<!--     <arg name="world" default="$(dirname)/../../worlds/emptyfarm.world"/> -->
<!--     <arg name="world" default="$(dirname)/../../worlds/rubicon.world"/> -->

    <!-- Husky Simulation -->
    <include file="$(dirname)/../husky_sim.launch">
        <arg name="world" value="$(arg world)"/>
    </include>

    <!-- SLAM -->
    <group>
        <!-- Cloud filterring -->
        <include file="$(dirname)/../cloud_filter.launch">
            <arg name="input" value="points"/>
            <arg name="output" value="points_filtered"/>
            <arg name="min_depth" value="1.0"/>
            <arg name="max_depth" value="15.0"/>
            <arg name="grid_res" value="0.1"/>
        </include>
        <include file="$(dirname)/../slam.launch">
            <arg name="cloud" value="points_filtered"/>
            <arg name="odom_frame" value="odom"/>
            <arg name="node_start_delay" value="10.0"/>
        </include>
    </group>

    <!-- Path planner -->
    <include file="$(dirname)/planner.launch">
        <arg name="points" value="points_filtered"/>
        <arg name="planning_freq" value="1.0"/>
        <arg name="path_planned" value="path"/>
        <arg name="node_start_delay" value="10.0"/>
    </include>

    <!-- Path follower -->
    <include file="$(dirname)/follower.launch">
        <arg name="path_to_follow" value="path"/>
        <arg name="odom_frame" value="odom"/>
        <arg name="points" value="points_filtered"/>
        <arg name="keep_path" value="1.0"/>
    </include>

    <!-- LSS input data recording -->
    <include if="$(arg record)" file="$(dirname)/../record.launch">
        <arg name="topics" value="'/realsense_front/color/image_raw/compressed'
                                  '/realsense_left/color/image_raw/compressed'
                                  '/realsense_right/color/image_raw/compressed'
                                  '/realsense_rear/color/image_raw/compressed'
                                  '/realsense_front/color/camera_info'
                                  '/realsense_left/color/camera_info'
                                  '/realsense_right/color/camera_info'
                                  '/realsense_rear/color/camera_info'
                                  '/points'
                                  '/tf' '/tf_static'"/>
        <arg name="path" value="$(dirname)/lss_input.bag"/>
    </include>

    <!-- RViz -->
    <node if="$(arg rviz)" name="rviz" pkg="rviz" type="rviz" args="-d $(dirname)/../../config/rviz/explore.rviz"/>
</launch>
