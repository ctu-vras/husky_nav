<?xml version="1.0" encoding="UTF-8" ?>
<launch>
    <arg name="rviz" default="true" doc="Launch RViz for data visualization or not"/>
    <arg name="record" default="false" doc="Record input data or not"/>
    <arg name="trav" default="false" doc="Launch height map estimator or not"/>
    <arg name="terrain_encoder" default="false" doc="Launch terrain encoder node or not"/>
<!--     <arg name="world" default="$(dirname)/../worlds/farmWith1CropRow.world"/> -->
<!--    <arg name="world" default="$(dirname)/../worlds/simcity.world"/> -->
<!--     <arg name="world" default="$(dirname)/../worlds/simcity_dynamic.world"/> -->
<!--     <arg name="world" default="$(dirname)/../worlds/emptyfarm.world"/> -->
<!--     <arg name="world" default="inspection"/> -->
    <arg name="world" default="$(dirname)/../worlds/terrain_vegetation.world"/>

    <arg unless="$(eval 'simcity' in world)" name="delay" default="0.0" doc="Delay before starting nodes in seconds"/>
    <arg if="$(eval 'simcity' in world)" name="delay" default="3.0" doc="Delay before starting nodes in seconds"/>
    <arg name="lss_weights" default="$(find monoforce)/config/weights/lss/lss_sim.pt" doc="Path to LSS weights file"/>

    <!-- Husky Simulation -->
    <include file="$(dirname)/husky_sim.launch">
        <arg name="world" value="$(arg world)"/>
        <arg name="gui" value="false"/>
    </include>

    <!-- Husky Exploration -->
    <include file="$(dirname)/naex/exploration.launch"/>

    <!-- Terrain Encoder -->
    <include if="$(arg terrain_encoder)" file="$(find monoforce)/launch/terrain_encoder.launch">
        <arg name="img_topics" value="['/ids_camera_front/image_raw/compressed',
                                       '/ids_camera_left/image_raw/compressed',
                                       '/ids_camera_rear/image_raw/compressed',
                                       '/ids_camera_right/image_raw/compressed',]"/>
        <arg name="camera_info_topics" value="['/ids_camera_front/camera_info',
                                               '/ids_camera_left/camera_info',
                                               '/ids_camera_rear/camera_info',
                                               '/ids_camera_right/camera_info']"/>
        <arg name="hm_frame" value="base_link"/>
        <arg name="max_msgs_delay" value="0.2"/>
        <arg name="max_age" value="0.5"/>
        <arg name="weights" value="$(find monoforce)/config/weights/lss/lss_robingas_$(arg robot).pt"/>
        <arg name="dphys_config_path" value="$(find monoforce)/config/dphys_cfg.yaml"/>
        <arg name="lss_config_path" value="$(find monoforce)/config/lss_cfg_$(arg robot).yaml"/>
        <arg name="n_cams" default="$(arg n_cams)"/>
    </include>

    <!-- Height map estimation -->
    <include if="$(arg trav)" file="$(find monoforce)/launch/hm_estimator.launch">
        <arg name="pts_topics" value="[/points]"/>
    </include>

    <!-- LSS input data recording -->
    <include if="$(arg record)" file="$(dirname)/../record.launch">
        <arg name="topics" value="'/realsense_front/color/image_raw/compressed'
                                  '/realsense_left/color/image_raw/compressed'
                                  '/realsense_right/color/image_raw/compressed'
                                  '/realsense_rear/color/image_raw/compressed'
                                  '/realsense_front/color/camera_info'
                                  '/realsense_left/color/camera_info'
                                  '/realsense_right/color/camera_info'
                                  '/realsense_rear/color/camera_info'
                                  '/points'
                                  '/tf' '/tf_static'"/>
        <arg name="path" value="$(dirname)/husky_navigation.bag"/>
        <arg name="delay" value="$(arg delay)"/>
    </include>

    <!-- RViz -->
    <node if="$(arg rviz)" name="rviz" pkg="rviz" type="rviz" args="-d $(dirname)/../config/rviz/explore.rviz"/>
</launch>
